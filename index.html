<!Doctype html>
<html>
<head>
<title>Dummy Donkey</title>
<link rel="shortcut icon" href="dd_64.png" type="image/png" />
<link rel="stylesheet" href="pure-min.css">
<script src="jquery-2.1.1.min.js"></script>
<script src="angular.min.js"></script>
</head>
<body>
<script>
var token = document.cookie;
if(!token){
	var btn = document.createElement('button');
	btn.innerText = 'Auth';
	btn.onclick = function(){
		location.href = 'https://github.com/login/oauth/authorize?client_id=37166cf1a32a1b3f6701&scope=user,repo';
	}
	document.getElementsByTagName('body')[0].appendChild(btn);
}
else{
	getRepoList(showlist);
}

function githubApiRequest(uri, parameter, callback){
	if(typeof(parameter)=='function'){
		callback = parameter;
		parameter = {};
	}
	else{
		parameter = parameter?parameter:{};
	}
	var q = '';
	for (var key in parameter) {
		q += key + '=' + parameter[key]+'&';
	}
	q += 'access_token='+token;
	var url = 'https://api.github.com'+uri+'?'+q;
	$.ajax({
		url: url,
		dataType: 'json',
		success: callback
	});
}

function getUserInfo(callback){
	githubApiRequest('/user', callback);
}

function getRepoList(callback){
	githubApiRequest('/user/repos', callback);
}

function showlist(repos){
	getUserInfo(function(r){
		var username = r.login;
		var ul = document.createElement('ul');
		for(var i=0; i<repos.length; i++){
			var li = document.createElement('li');
			li.innerText = repos[i].full_name;
			if(repos[i].full_name.toLowerCase() == (username+'/'+username+'.github.io').toLowerCase() || repos[i].full_name.toLowerCase() == (username+'/'+username+'.github.com').toLowerCase()){
				li.style.color = 'red';
			}
			ul.appendChild(li);
		}
		document.getElementsByTagName('body')[0].appendChild(ul);
	});
}
</script>
</body>
</html>